<style media="screen">
  table td,
  table th {
    padding: 5px;
  }
</style>
<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span> Tutup</button>
    <h4 class="modal-title">Rujukan Vertikal</h4>
</div>
<div class="modal-body">
  <div class="row" style="margin-top:20px;">
    <input type="hidden" name="t" value="{?=$_SESSION['token']?}">
    <input type="hidden" id="addrujukan" name="addrujukan" class="form-control" value="">
    <div class="col col-md-3">
      <div class="form-group">
        <label for="poli">Nomor Rekam Medis</label>
        <input type="text" id="no_rkm_medis" name="no_rkm_medis" class="form-control" value="{$bridging_sep.nomr}">
      </div>
    </div>
    <div class="col col-md-3">
      <div class="form-group">
        <label for="poli">Nomor Rawat</label>
        <input type="text" id="no_rawat" name="no_rawat" class="form-control" value="{$bridging_sep.no_rawat}">
      </div>
    </div>
    <div class="col col-md-3">
      <div class="form-group">
        <label for="poli">Nomor Kartu</label>
        <input type="text" id="noKartu" name="noKartu" class="form-control" value="{$bridging_sep.no_kartu}">
      </div>
    </div>
    <div class="col col-md-3">
      <div class="form-group">
        <label for="poli">Nomor SEP</label>
        <input type="text" id="noSep" name="noSep" class="form-control" value="{$bridging_sep.no_sep}">
      </div>
    </div>
    <div class="col col-md-3">
      <div class="form-group">
        <label for="poli">Tanggal Rujukan</label>
        <input type="text" id="tglRujukan" name="tglRujukan" class="form-control tanggal" value="{?=date('Y-m-d')?}">
      </div>
    </div>
    <div class="col col-md-3">
      <div class="form-group">
        <label for="poli">Tanggal Kunjungan</label>
        <input type="text" id="tglRencanaKunjungan" name="tglRencanaKunjungan" class="form-control tanggal" value="{?=date('Y-m-d')?}">
      </div>
    </div>
    <div class="col col-md-3">
      <div class="form-group">
        <label for="poli">Jenis Layanan</label>
        <select class="form-control" name="jnsPelayanan" id="jnsPelayanan">
          <option value="1">Rawat Inap</option>
          <option value="2">Rawat Jalan</option>
        </select>
      </div>
    </div>
    <div class="col col-md-3">
      <div class="form-group">
        <label for="poli">Tipe Rujukan</label>
        <select class="form-control" name="tipeRujukan" id="tipeRujukan">
          <option value="0">Rujukan Penuh</option>
          <option value="1">Rujukan Partial</option>
          <option value="2">Rujuk Balik PRB</option>
        </select>
      </div>
    </div>
    <div class="col col-md-6">
      <div class="form-group">
        <label for="poli">PPK Rujukan</label>
        <input type="text" id="getPpkDirujuk" name="getPpkDirujuk" class="form-control" value="">
        <ul class="list-group" id="referensiPpkDirujukList" style="z-index:1000;position:absolute;width:100%;"></ul>
      </div>
    </div>
    <div class="col col-md-6">
      <div class="form-group">
        <label for="poli">Poli Rujukan</label>
        <input type="text" name="getPoliRujukan" id="getPoliRujukan" class="form-control" value="">
        <ul class="list-group" id="referensiPoliRujukanList" style="z-index:1000;position:absolute;width:100%;"></ul>
      </div>
    </div>
    <div class="col col-md-12">
      <div class="form-group">
        <label for="poli">Diagnosa Rujukan</label>
        <input type="text" name="getDiagnosa" id="getDiagnosa" class="form-control" value="">
        <ul class="list-group" id="referensiDiagnosaList" style="z-index:1000;position:absolute;width:100%;"></ul>
      </div>
    </div>
    <div class="col col-md-12">
      <div class="form-group">
        <label for="poli">Procedure Rujukan</label>
        <input type="text" name="getProcedure" id="getProcedure" class="form-control" value="">
        <ul class="list-group" id="referensiProcedureList" style="z-index:1000;position:absolute;width:100%;"></ul>
      </div>
    </div>
    <div class="col col-md-12">
      <div class="form-group">
        <label for="poli">Catatan</label>
        <textarea name="catatan" id="catatan" class="form-control" rows="4" cols="80"></textarea>
      </div>
    </div>

    <div class="col col-md-12">
      <div class="checkbox">
        <label class="pull-right">
            <input type="checkbox" name="rujukankhusus" id="rujukankhusus"/> Rujukan Khusus
        </label>
      </div>
    </div>

    <div class="col col-md-12">
      <button class="btn btn-success simpandirujuk">
          Simpan
      </button>
      <button class="btn btn-info editdirujuk">
          Edit
      </button>
      <button class="btn btn-danger hapusdirujuk">
          Hapus
      </button>
    </div>
  </div>
  <div class="tampildatadirujuk" style="margin-top:30px;">
    <h4>Data Rujukan</h4>
    <div class="table-responsive">
    <table class="table table-bordered table-striped table-hover display nowrap datatabledirujuk" width="100%">
      <thead>
        <tr>
          <th>Tgl. Rujukan</th>
          <th>Tgl. Kunjungan</th>
          <th>No. RM</th>
          <th>Nama Pasien</th>
          <th>No. Kartu</th>
          <th>No. SEP</th>
          <th>PPK Dirujuk</th>
          <th>Nama Poli</th>
          <th>Jenis Pelayanan</th>
          <th>Tipe Rujukan</th>
          <th>Diagnosa</th>
          <th>Prosedur</th>
          <th>Catatan</th>
          <th>User</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {loop: $dirujuk}
        <tr>
          <td>{$value.tgl_kunjungan}</td>
          <td>{$value.no_rawat}</td>
          <td>{$value.no_rkm_medis}</td>
          <td>{$value.nm_pasien}</td>
          <td>{$value.nomor_jaminan}</td>
          <td>{$value.nama_poli}</td>
          <td>{$value.subyektif}</td>
          <td>{?=($value.kunjungan_sakit === 'true') ? 'Kunjungan Sakit' : 'Kunjungan Sehat'?}</td>
          <td>{$value.sistole}</td>
          <td>{$value.diastole}</td>
          <td>{$value.berat}</td>
          <td>{$value.tinggi}</td>
          <td>{$value.respirasi}</td>
          <td>{$value.lingkar_perut}</td>
          <td>{$value.status_kirim}</td>
        </tr>
        {/loop}
      </tbody>
    </table>
    </div>
  </div>
</div>

<div class="modal-footer">
    <button type="button" class="btn btn-primary" data-dismiss="modal">Tutup</button>
</div>

<script type="text/javascript">
  $('select').selectator();
  $('.collapse').collapse();
  $("#tampilfaskesspesialiskhusus").hide();
  $("#rujukankhusus").click(function() {
      if($(this).is(":checked")) {
          $("#tampilfaskesspesialis").hide();
          $("#tampilfaskesspesialiskhusus").show();
      } else {
          $("#tampilfaskesspesialis").show();
          $("#tampilfaskesspesialiskhusus").hide();
      }
  });
</script>
<script type="text/javascript">
   $(function () {
       $('.tanggal').datetimepicker({
         format: 'YYYY-MM-DD',
         locale: 'id'
       });
   });
</script>
<script type="text/javascript">
  $('.datatabledirujuk').DataTable();
</script>
<script type="text/javascript">
  $('#getPpkDirujuk').keyup(function(){
    if($('#getPpkDirujuk').val().length >= 3 && $('#getPpkDirujuk').val() != ""){
      var query = $(this).val();
      var faskes = $('#getPpkDirujuk').val();
      $.ajax({
           url: '{?=url()?}/{?=ADMIN?}/vclaim/faskes/' + faskes + '/2?t={?=$_SESSION['token']?}',
           method:"GET",
           data:{},
           success:function(data)
           {
               var data = JSON.parse(data);
               var json_obj = [data];
               var output='';
               if(json_obj[0].metaData.code == 200) {
                 var faskes = json_obj[0].response.faskes;
                 for (var i in faskes) {
                   output+='<li class=\"list-group-item link-class\">' + faskes[i].kode + ': ' + faskes[i].nama + '</li>';
                 }
               } else {
                 output+='<li class=\"list-group-item link-class\">' + json_obj[0].metaData.message + '</li>';
               }
               output+='';
               //console.log(output);
               $('#referensiPpkDirujukList').fadeIn();
               $('#referensiPpkDirujukList').html(output).show();
           }
      });
    }
  });
  $('#referensiPpkDirujukList').on('click', 'li', function(){
       $('#getPpkDirujuk').val($(this).text());
       var getPpkDirujuk = $('#getPpkDirujuk').val();
       $('#referensiPpkDirujukList').fadeOut();
  });
</script>
<script type="text/javascript">
  $('#getPoliRujukan').keyup(function(){
    if($('#getPoliRujukan').val().length >= 3 && $('#getPoliRujukan').val() != ""){
      var query = $(this).val();
      var poli = $('#getPoliRujukan').val();
      $.ajax({
           url: '{?=url()?}/{?=ADMIN?}/vclaim/poli/' + poli + '?t={?=$_SESSION['token']?}',
           method:"GET",
           data:{},
           success:function(data)
           {
               var data = JSON.parse(data);
               var json_obj = [data];
               var output='';
               if(json_obj[0].metaData.code == 200) {
                 var poli = json_obj[0].response.poli;
                 for (var i in poli) {
                   output+='<li class=\"list-group-item link-class\">' + poli[i].kode + ': ' + poli[i].nama + '</li>';
                 }
               } else {
                 output+='<li class=\"list-group-item link-class\">' + json_obj[0].metaData.message + '</li>';
               }
               output+='';
               //console.log(output);
               $('#referensiPoliRujukanList').fadeIn();
               $('#referensiPoliRujukanList').html(output).show();
           }
      });
    }
  });
  $('#referensiPoliRujukanList').on('click', 'li', function(){
       $('#getPoliRujukan').val($(this).text());
       var getPoliRujukan = $('#getPoliRujukan').val();
       $('#referensiPoliRujukanList').fadeOut();
  });
</script>
<script type="text/javascript">
  $('#getDiagnosa').keyup(function(){
    if($('#getDiagnosa').val().length >= 3 && $('#getDiagnosa').val() != ""){
      var query = $(this).val();
      var diagnosa = $('#getDiagnosa').val();
      $.ajax({
           url: '{?=url()?}/{?=ADMIN?}/vclaim/diagnosa/' + diagnosa + '?t={?=$_SESSION['token']?}',
           method:"GET",
           data:{},
           success:function(data)
           {
               var data = JSON.parse(data);
               var json_obj = [data];
               var output='';
               if(json_obj[0].metaData.code == 200) {
                 var diagnosa = json_obj[0].response.diagnosa;
                 for (var i in diagnosa) {
                   output+='<li class=\"list-group-item link-class\">' + diagnosa[i].kode + ': ' + diagnosa[i].nama + '</li>';
                 }
               } else {
                 output+='<li class=\"list-group-item link-class\">' + json_obj[0].metaData.message + '</li>';
               }
               output+='';
               $('#referensiDiagnosaList').fadeIn();
               $('#referensiDiagnosaList').html(output).show();
           }
      });
    }
  });
  $('#referensiDiagnosaList').on('click', 'li', function(){
       $('#getDiagnosa').val($(this).text());
       var getDiagnosa = $('#getDiagnosa').val();
       $('#referensiDiagnosaList').fadeOut();
  });
</script>
<script type="text/javascript">
  $('#getProcedure').keyup(function(){
    if($('#getProcedure').val().length >= 3 && $('#getProcedure').val() != ""){
      var query = $(this).val();
      var procedure = $('#getProcedure').val();
      $.ajax({
           url: '{?=url()?}/{?=ADMIN?}/vclaim/procedure/' + procedure + '?t={?=$_SESSION['token']?}',
           method:"GET",
           data:{},
           success:function(data)
           {
               var data = JSON.parse(data);
               var json_obj = [data];
               var output='';
               if(json_obj[0].metaData.code == 200) {
                 var procedure = json_obj[0].response.procedure;
                 for (var i in procedure) {
                   output+='<li class=\"list-group-item link-class\">' + procedure[i].kode + ': ' + procedure[i].nama + '</li>';
                 }
               } else {
                 output+='<li class=\"list-group-item link-class\">' + json_obj[0].metaData.message + '</li>';
               }
               output+='';
               $('#referensiProcedureList').fadeIn();
               $('#referensiProcedureList').html(output).show();
           }
      });
    }
  });
  $('#referensiProcedureList').on('click', 'li', function(){
       $('#getProcedure').val($(this).text());
       var getProcedure = $('#getProcedure').val();
       $('#referensiProcedureList').fadeOut();
  });
</script>
<script type="text/javascript">
$(document).ready(function(){
  $(".simpandirujuk").click(function(){
    var baseURL = mlite.url + '/' + mlite.admin;
    var noSep = $('input:text[name=noSep]').val();
    var tglRujukan = $('input:text[name=tglRujukan]').val();
    var tglRencanaKunjungan = $('input:text[name=tglRencanaKunjungan]').val();
    var ppkDirujuk = $('input:text[name=getPpkDirujuk]').val().split(':')[0];
    var jnsPelayanan = $('select[name=jnsPelayanan]').val();
    var diagRujukan = $('input:text[name=getDiagnosa]').val().split(':')[0];
    var tipeRujukan = $('select[name=tipeRujukan]').val();
    var poliRujukan = $('input:text[name=getPoliRujukan]').val().split(':')[0];
    var procRujukan = $('input:text[name=getProcedure]').val().split(':')[0];
    if($('#rujukankhusus').is(':checked')){
      var rujukankhusus = 'true';
    }
    else{
      var rujukankhusus = 'false';
    }
    var catatan = $('textarea[name=catatan]').val();
    var url = baseURL + '/vclaim/rujukansave/?t=' + mlite.token;
    //alert('No SEP: ' + noSep + ' Tanggal Rujukan: ' + tglRujukan + ' Rencana Kunjungan : ' + tglRencanaKunjungan + ' PPK Rujukan : ' + ppkDirujuk + ' Jenise Pelayanan : ' + jnsPelayanan + ' Diagnosa : ' + diagRujukan + ' Procedure : ' + procRujukan + ' Tipe Rujukan : ' + tipeRujukan + ' Poli Rujukan : ' + poliRujukan);
    $.post(url,{
      noSep: noSep,
      tglRujukan: tglRujukan,
      tglRencanaKunjungan: tglRencanaKunjungan,
      ppkDirujuk: ppkDirujuk,
      jnsPelayanan: jnsPelayanan,
      diagRujukan: diagRujukan,
      tipeRujukan: tipeRujukan,
      poliRujukan: poliRujukan,
      procRujukan: procRujukan,
      rujukankhusus: rujukankhusus,
      catatan: catatan
    } ,function(data) {
      $('.tampildatadirujuk').load(baseURL + '/vclaim/dirujuktampil/' + no_rkm_medis + '?t=' + mlite.token);
    });
  });
});
</script>
